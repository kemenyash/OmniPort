@using Microsoft.AspNetCore.Components.Forms

<InputFile OnChange="LoadFile" />

@code {
    [Parameter] public EventCallback<(Stream, List<Dictionary<string, object?>>)> OnFileLoaded { get; set; }

    private async Task LoadFile(InputFileChangeEventArgs e)
    {
        var file = e.File;
        using var stream = file.OpenReadStream();

        using var reader = new StreamReader(stream);
        var json = await reader.ReadToEndAsync();
        var data = System.Text.Json.JsonSerializer.Deserialize<List<Dictionary<string, object?>>>(json);

        if (data != null)
        {
            using var reset = file.OpenReadStream();
            await OnFileLoaded.InvokeAsync((reset, data));
        }
    }
}
